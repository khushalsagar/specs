<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>CSS Stacking Context Module Level 1</title>
  <meta content="UD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2021/W3C-UD" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version 616204878, updated Tue Mar 8 15:25:09 2022 -0800" name="generator">
  <link href="https://drafts.csswg.org/css-stacking-context/" rel="canonical">
  <meta content="7880ad70f7bd51502183fd722e53d81db567769b" name="document-revision">
<style>
/* Put nice boxes around each algorithm. */
[data-algorithm]:not(.heading) {
  padding: .5em;
  border: thin solid #ddd; border-radius: .5em;
  margin: .5em calc(-0.5em - 1px);
}
[data-algorithm]:not(.heading) > :first-child {
  margin-top: 0;
}
[data-algorithm]:not(.heading) > :last-child {
  margin-bottom: 0;
}
[data-algorithm] [data-algorithm] {
    margin: 1em 0;
}
</style>
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-issues */

a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-var-click-highlighting */

    var { cursor: pointer; }
    var.selected0 { background-color: #F4D200; box-shadow: 0 0 0 2px #F4D200; }
    var.selected1 { background-color: #FF87A2; box-shadow: 0 0 0 2px #FF87A2; }
    var.selected2 { background-color: #96E885; box-shadow: 0 0 0 2px #96E885; }
    var.selected3 { background-color: #3EEED2; box-shadow: 0 0 0 2px #3EEED2; }
    var.selected4 { background-color: #EACFB6; box-shadow: 0 0 0 2px #EACFB6; }
    var.selected5 { background-color: #82DDFF; box-shadow: 0 0 0 2px #82DDFF; }
    var.selected6 { background-color: #FFBCF2; box-shadow: 0 0 0 2px #FFBCF2; }
    </style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2021/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">CSS Stacking Context Module Level 1</h1>
   <p id="w3c-state"><a href="https://www.w3.org/standards/types#UD">Unofficial Proposal Draft</a>, <time class="dt-updated" datetime="2022-04-14">14 April 2022</time></p>
   <details open>
    <summary>More details about this document</summary>
    <div data-fill-with="spec-metadata">
     <dl>
      <dt>This version:
      <dd><a class="u-url" href="https://drafts.csswg.org/css-stacking-context/">https://drafts.csswg.org/css-stacking-context/</a>
      <dt>Issue Tracking:
      <dd><a href="https://github.com/w3c/csswg-drafts/labels/css-stacking-context-1">CSSWG Issues Repository</a>
      <dd><a href="#issues-index">Inline In Spec</a>
      <dt class="editor">Editor:
      <dd class="editor p-author h-card vcard" data-editor-id="42199"><a class="p-name fn u-url url" href="http://xanthir.com/contact/">Tab Atkins-Bittner</a> (<span class="p-org org">Google</span>)
      <dt>Suggest an Edit for this Spec:
      <dd><a href="https://github.com/w3c/csswg-drafts/blob/main/css-stacking-context-1/Overview.bs">GitHub Editor</a>
     </dl>
    </div>
   </details>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2022 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document" rel="license">permissive document license</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This module defines the painting model for CSS.</p>
    <a href="https://www.w3.org/TR/CSS/">CSS</a> is a language for describing the rendering of structured documents
(such as HTML and XML)
on screen, on paper, etc. 
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p><em>This section describes the status of this document at the time of its publication.
	A list of current W3C publications
	and the latest revision of this technical report
	can be found in the <a href="https://www.w3.org/TR/">W3C technical reports index at https://www.w3.org/TR/.</a></em> </p>
   <p>Please send feedback
	by <a href="https://github.com/w3c/csswg-drafts/issues">filing issues in GitHub</a> (preferred),
	including the spec code “css-stacking-context” in the title, like this:
	“[css-stacking-context] <i>…summary of comment…</i>”.
	All issues and comments are <a href="https://lists.w3.org/Archives/Public/public-css-archive/">archived</a>.
	Alternately, feedback can be sent to the (<a href="https://lists.w3.org/Archives/Public/www-style/">archived</a>) public mailing list <a href="mailto:www-style@w3.org?Subject=%5Bcss-stacking-context%5D%20PUT%20SUBJECT%20HERE">www-style@w3.org</a>. </p>
   <p>This document is governed by the <a href="https://www.w3.org/2021/Process-20211102/" id="w3c_process_revision">2 November 2021 W3C Process Document</a>. </p>
   <p>This document was produced by a group operating under the <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/">W3C Patent Policy</a>.
	W3C maintains a <a href="https://www.w3.org/groups/wg/css/ipr" rel="disclosure">public list of any patent disclosures</a> made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes
	contains <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#def-essential">Essential Claim(s)</a> must disclose the information in accordance with <a href="https://www.w3.org/Consortium/Patent-Policy-20200915/#sec-Disclosure">section 6 of the W3C Patent Policy</a>. </p>
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#intro"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#order"><span class="secno">2</span> <span class="content">Painting Order</span></a>
     <ol class="toc">
      <li><a href="#stacking-notes"><span class="secno">2.1</span> <span class="content">Notes</span></a>
     </ol>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content"> Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content"> Document conventions</span></a>
      <li><a href="#w3c-conformance-classes"><span class="secno"></span> <span class="content"> Conformance classes</span></a>
      <li>
       <a href="#w3c-partial"><span class="secno"></span> <span class="content"> Partial implementations</span></a>
       <ol class="toc">
        <li><a href="#w3c-conform-future-proofing"><span class="secno"></span> <span class="content"> Implementations of Unstable and Proprietary Features</span></a>
       </ol>
      <li><a href="#w3c-testing"><span class="secno"></span> <span class="content"> Non-experimental implementations</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="intro"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p><em>This section is not normative.</em></p>
   <p>Elements on a page can have many overlapping parts.
	This specification defines the precise order
	that every part of an element
	and the surrounding page
	is painted,
	so that things render above (or below) other things
	in a well-defined way.</p>
   <h2 class="heading settled" data-level="2" id="order"><span class="secno">2. </span><span class="content">Painting Order</span><a class="self-link" href="#order"></a></h2>
   <p>The rendering structure of a document consists of
	a <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas">root canvas</a>,
	a <a data-link-type="dfn" href="#document-layer" id="ref-for-document-layer">document layer</a> and any number of additional <a data-link-type="dfn" href="#css-rendering-layer" id="ref-for-css-rendering-layer">rendering layers</a>,
	and within each layer,
	a <a data-link-type="dfn" href="https://infra.spec.whatwg.org/#list" id="ref-for-list">list</a> of one or more <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-tree" id="ref-for-concept-tree">trees</a> of <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box">boxes</a> generated by <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#elements" id="ref-for-elements">elements</a>.</p>
   <p>A <dfn class="dfn-paneled" data-dfn-for="CSS" data-dfn-type="dfn" data-export id="css-canvas">canvas</dfn> is a theoretically-infinite 2D field of color.
	The <dfn class="dfn-paneled" data-dfn-for="CSS" data-dfn-type="dfn" data-export id="css-root-canvas">root canvas</dfn> is the <a data-link-type="dfn" href="#css-canvas" id="ref-for-css-canvas">canvas</a> upon which all of the document’s content is rendered.
	Layers, and elements that generate stacking contexts,
	first render onto temporary <span id="ref-for-css-canvas①">canvases</span> before being composited onto an ancestor canvas
	(ending with the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas①">root canvas</a> for the document).</p>
   <p>A <dfn class="dfn-paneled" data-dfn-for="CSS" data-dfn-type="dfn" data-export data-local-lt="layer" id="css-rendering-layer">rendering layer</dfn> is an ordered list of <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box①">boxes</a>,
	where each layer is rendered fully atop all previous layers,
	and fully below all following layers.
	Within the layer, <span id="ref-for-box②">boxes</span> and their descendants
	can potentially interweave their rendering with each other.
	The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="document-layer">document layer</dfn> is the layer
	containing the principal box of the document’s root element;
	it is below all other <a data-link-type="dfn" href="#css-rendering-layer" id="ref-for-css-rendering-layer①">rendering layers</a>.</p>
   <div class="algorithm" data-algorithm="paint a document">
     To <dfn data-dfn-type="dfn" data-export data-lt="paint a document|paint the document" id="paint-a-document">paint a document<a class="self-link" href="#paint-a-document"></a></dfn>: 
    <ol>
     <li data-md>
      <p>If the document is being painted as part of another document
(such as an <code><a data-link-type="element" href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element" id="ref-for-the-iframe-element">iframe</a></code>'s document),
then the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas②">root canvas</a> is initially <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-4/#transparent-black" id="ref-for-transparent-black">transparent black</a> everywhere.</p>
      <p>Otherwise, the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas③">root canvas</a> is a UA-defined color everywhere.
This can be affected by things such as, but not limited to,
the <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-color-adjust-1/#propdef-color-scheme" id="ref-for-propdef-color-scheme">color-scheme</a> property.</p>
      <p>Other specifications can define that the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas④">root canvas</a> begins as another color in certain circumstances.</p>
     <li data-md>
      <p><a data-link-type="dfn" href="#paint-a-layer" id="ref-for-paint-a-layer">Paint the document layer</a> onto the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas⑤">root canvas</a>.</p>
     <li data-md>
      <p>For each additional <a data-link-type="dfn" href="#css-rendering-layer" id="ref-for-css-rendering-layer②">rendering layer</a>, in order from bottom to top, <a data-link-type="dfn" href="#paint-a-layer" id="ref-for-paint-a-layer①">paint the layer</a> onto the <a data-link-type="dfn" href="#css-root-canvas" id="ref-for-css-root-canvas⑥">root canvas</a>.</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="paint a layer">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="paint a layer|paint the layer" id="paint-a-layer">paint a layer</dfn> <var>layer</var> onto a <var>root canvas</var>: 
    <ol>
     <li data-md>
      <p>Let <var>canvas</var> be a fresh <a data-link-type="dfn" href="#css-canvas" id="ref-for-css-canvas②">canvas</a>.
initially <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-4/#transparent-black" id="ref-for-transparent-black①">transparent black</a> everywhere.</p>
     <li data-md>
      <p>If <var>layer</var> is the <a data-link-type="dfn" href="#document-layer" id="ref-for-document-layer①">document layer</a>,
and the root element generates a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box③">box</a>,
then the root element <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="propagate its background" id="propagate-its-background">propagates its background</dfn> to <var>canvas</var>:
the root element’s <a class="property css" data-link-type="property" href="https://drafts.csswg.org/css-backgrounds-3/#propdef-background" id="ref-for-propdef-background">background</a> is painted onto <var>canvas</var>,
using all of <var>canvas</var> as the <a data-link-type="dfn" href="https://drafts.csswg.org/css-backgrounds-3/#background-painting-area" id="ref-for-background-painting-area">background painting area</a>,
but continuing to use the root element
to determine the <a data-link-type="dfn" href="https://drafts.csswg.org/css-backgrounds-3/#background-positioning-area" id="ref-for-background-positioning-area">background positioning area</a>.</p>
      <p class="issue" id="issue-6233971a"><a class="self-link" href="#issue-6233971a"></a> <a data-link-type="biblio" href="#biblio-css-contain-3">[CSS-CONTAIN-3]</a> should, apparently, block propagation,
but I can’t find that in the spec.
Figure out if I missed something,
and make it block propagation here.</p>
     <li data-md>
      <p>For each top-level <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box④">box</a> in <var>layer</var>, <a data-link-type="dfn" href="#paint-a-stacking-context" id="ref-for-paint-a-stacking-context">paint a stacking context</a> of the box onto <var>canvas</var>.</p>
     <li data-md>
      <p class="issue" id="issue-2a74f3b1"><a class="self-link" href="#issue-2a74f3b1"></a> Clipping/filtering/etc goes here.</p>
     <li data-md>
      <p>Composite <var>canvas</var> onto <var>root canvas</var>.</p>
      <p class="issue" id="issue-8f014af0"><a class="self-link" href="#issue-8f014af0"></a> Does only the document layer have non-trivial whole-layer compositing?</p>
    </ol>
   </div>
   <div class="algorithm" data-algorithm="paint a stacking context">
     To <dfn class="dfn-paneled" data-dfn-type="dfn" data-export data-lt="paint a stacking context|paint the stacking context" id="paint-a-stacking-context">paint a stacking context</dfn> with a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#box" id="ref-for-box⑤">box</a> <var>box</var> onto a <a data-link-type="dfn" href="#css-canvas" id="ref-for-css-canvas③">canvas</a> <var>root canvas</var>: 
    <ol>
     <li data-md>
      <p>Let <var>canvas</var> be a fresh <a data-link-type="dfn" href="#css-canvas" id="ref-for-css-canvas④">canvas</a>,
initially <a data-link-type="dfn" href="https://drafts.csswg.org/css-color-4/#transparent-black" id="ref-for-transparent-black②">transparent black</a> everywhere.</p>
     <li data-md>
      <dl class="switch">
       <dt data-md>If <var>box</var> is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#block-level" id="ref-for-block-level">block-level</a> box other than a <a data-link-type="dfn" href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box">table wrapper box</a>
       <dd data-md>
        <p>If <var>box</var> did <em>not</em> <a data-link-type="dfn" href="#propagate-its-background" id="ref-for-propagate-its-background">propagate its background</a>,
paint <var>box</var>’s background color onto <var>canvas</var>,
then background image.</p>
        <p>In all cases,
then paint <var>box</var>’s border onto <var>canvas</var>.</p>
       <dt data-md>If <var>box</var> if a <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#block-level" id="ref-for-block-level①">block-level</a> <a data-link-type="dfn" href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box①">table wrapper box</a>:
       <dd data-md>
        <p>Paint the following onto <var>canvas</var>, in order:</p>
        <ol>
         <li data-md>
          <p>If <var>box</var> did <em>not</em> <a data-link-type="dfn" href="#propagate-its-background" id="ref-for-propagate-its-background①">propagate its background</a>,
paint <var>box</var>’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint <var>box</var>’s column group’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint <var>box</var>’s column’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint <var>box</var>’s row group’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint <var>box</var>’s row’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint <var>box</var>’s cell’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint all of <var>box</var>’s table borders
(in tree order, for separated borders)
onto <var>canvas</var>.</p>
          <p class="issue" id="issue-09b8ddab"><a class="self-link" href="#issue-09b8ddab"></a> I think this needs more detail,
and I think <a data-link-type="biblio" href="#biblio-css-tables-3">[CSS-TABLES-3]</a> provides it.</p>
        </ol>
      </dl>
     <li data-md>
      <p>For each <a data-link-type="dfn" href="https://svgwg.org/svg2-draft/render.html#TermStackingContext" id="ref-for-TermStackingContext">stacking context</a> descendant of <var>box</var> with strictly negative z-indexes,
in z-index order
(most negative first),
then tree order, <a data-link-type="dfn" href="#paint-a-stacking-context" id="ref-for-paint-a-stacking-context①">paint a stacking context</a> for the descendant
onto <var>canvas</var>.</p>
     <li data-md>
      <p>For each in-flow,
non-<a data-link-type="dfn" href="https://drafts.csswg.org/css-position-3/#positioned-box" id="ref-for-positioned-box">positioned</a>, <a data-link-type="dfn" href="https://drafts.csswg.org/css-display-3/#block-level" id="ref-for-block-level②">block-level</a> descendant of <var>box</var>,
in tree order:</p>
      <dl class="switch">
       <dt data-md>If the descendant is not a <a data-link-type="dfn" href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box②">table wrapper box</a>
       <dd data-md>
        <p>Paint its background color,
then background image,
then border
onto <var>canvas</var>.</p>
       <dt data-md>If the descendant is a <a data-link-type="dfn" href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box" id="ref-for-table-wrapper-box③">table wrapper box</a>
       <dd data-md>
        <ol>
         <li data-md>
          <p>Paint its backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint its column group’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint its column’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint its row group’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint its row’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint its cell’s backgrounds
(color, then image)
onto <var>canvas</var>.</p>
         <li data-md>
          <p>Paint all of <var>box</var>’s table borders
(in tree order, for separated borders)
onto <var>canvas</var>.</p>
        </ol>
      </dl>
     <li data-md>
      <p>For each non-positioned,
floating
descendant of <var>box</var>:</p>
      <ol>
       <li data-md>
      </ol>
    </ol>
   </div>
   <li> All non-positioned floating descendants, in tree order. For
	each one of these, treat the element as if it created a new
	stacking context, but any positioned descendants and
	descendants which actually create a new stacking context
	should be considered part of the parent stacking context, not
	this new one. 
   <li>
     If the element is an inline element that generates a
	stacking context, then: 
    <ol>
     <li>
       For each line box that the element is in: 
      <ol>
       <li>Jump to <a href="#each-box">7.2.1</a> for the
	      box(es) of the element in that line box (in tree order). 
      </ol>
    </ol>
   <li>
     Otherwise: first for the element, then for all its in-flow,
	non-positioned, block-level descendants in tree order: 
    <ol>
     <li> If the element is a block-level replaced element, then:
	    the replaced content, atomically. 
     <li>
       Otherwise, for each line box of that element: 
      <ol>
       <li id="each-box">
        <a class="self-link" href="#each-box"></a> For each box that is a child of that element, in
		that line box, in tree order: 
        <ol>
         <li> background color of element. 
         <li> background image of element. 
         <li> border of element. 
         <li>
           For inline elements: 
          <ol>
           <li>
             For all the element’s in-flow,
			non-positioned, inline-level children that are
			in this line box, and all runs of text inside
			the element that is on this line box, in tree
			order: 
            <ol>
             <li>
               If this is a run of text, then: 
              <ol>
               <li>any underlining affecting the text
			      of the element, in tree order of the
			      elements applying the underlining (such
			      that the deepest element’s underlining,
			      if any, is painted topmost and the root
			      element’s underlining, if any, is drawn
			      bottommost). 
               <li>any overlining affecting the text of
			      the element, in tree order of the
			      elements applying the overlining (such
			      that the deepest element’s overlining,
			      if any, is painted topmost and the root
			      element’s overlining, if any, is drawn
			      bottommost). 
               <li>the text. 
               <li>any line-through affecting the text
			      of the element, in tree order of the
			      elements applying the line-through (such
			      that the deepest element’s line-through,
			      if any, is painted topmost and the root
			      element’s line-through, if any, is drawn
			      bottommost). 
              </ol>
             <li> Otherwise, jump to <a href="#each-box">7.2.1</a> for that
			    element. 
            </ol>
          </ol>
          <p>For inline-block and inline-table elements:</p>
          <ol>
           <li>For each one of these, treat the element as
		      if it created a new stacking context, but any
		      positioned descendants and descendants which
		      actually create a new stacking context should be
		      considered part of the parent stacking context,
		      not this new one. 
          </ol>
          <p>For inline-level replaced elements:</p>
          <ol>
           <li>the replaced content, atomically. 
          </ol>
        </ol>
        <p class="note" role="note">Some of the boxes may have been
		generated by line splitting or the Unicode
		bidirectional algorithm. </p>
       <li> Optionally, the outline of the element (see <a href="#outlines">10 below</a>). 
      </ol>
     <li> Optionally, if the element is block-level, the outline
	    of the element (see <a href="#outlines">10 below</a>). 
    </ol>
   <li> All positioned descendants with 'z-index: auto' or
	'z-index: 0', in tree order. For those with 'z-index: auto',
	treat the element as if it created a new stacking context, but
	any positioned descendants and descendants which actually
	create a new stacking context should be considered part of the
	parent stacking context, not this new one. For those with
	'z-index: 0', treat the stacking context generated atomically. 
   <li> Stacking contexts formed by positioned descendants with
	z-indices greater than or equal to 1 in z-index order
	(smallest first) then tree order. 
   <li id="outlines">
    <a class="self-link" href="#outlines"></a> Finally, implementations that do not draw outlines in steps
	above must draw outlines from this stacking context at this
	stage. (It is recommended to draw outlines in this step and
	not in the steps above.) 
    <h3 class="heading settled" data-level="2.1" id="stacking-notes"><span class="secno">2.1. </span><span class="content">Notes</span><a class="self-link" href="#stacking-notes"></a></h3>
    <p>The background of the root element is only painted once, over
    the whole canvas.</p>
    <p>While the backgrounds of bidirectional inlines are painted in
    tree order, they are positioned in visual order. Since the
    positioning of inline backgrounds is unspecified in CSS 2,
    the exact result of these two requirements is UA-defined. CSS3 may
    define this in more detail.</p>
  </main>
  <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content"> Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
  <h3 class="no-ref heading settled" id="w3c-conventions"><span class="content"> Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words “MUST”,
    “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
    “RECOMMENDED”, “MAY”, and “OPTIONAL” in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification. </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>
  <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text with <code>class="example"</code>,
    like this: </p>
  <div class="example" id="w3c-example">
   <a class="self-link" href="#w3c-example"></a> 
   <p>This is an example of an informative example.</p>
  </div>
  <p>Informative notes begin with the word “Note” and are set apart from the
    normative text with <code>class="note"</code>, like this: </p>
  <p class="note" role="note">Note, this is an informative note.</p>
  <p>Advisements are normative sections styled to evoke special attention and are
    set apart from other normative text with <code>&lt;strong class="advisement"></code>, like
    this: <strong class="advisement"> UAs MUST provide an accessible alternative. </strong></p>
  <h3 class="no-ref heading settled" id="w3c-conformance-classes"><span class="content"> Conformance classes</span><a class="self-link" href="#w3c-conformance-classes"></a></h3>
  <p>Conformance to this specification
    is defined for three conformance classes: </p>
  <dl>
   <dt>style sheet 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
            style sheet</a>. 
   <dt>renderer 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that interprets the semantics of a style sheet and renders
            documents that use them. 
   <dt>authoring tool 
   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a> that writes a style sheet. 
  </dl>
  <p>A style sheet is conformant to this specification
    if all of its statements that use syntax defined in this module are valid
    according to the generic CSS grammar and the individual grammars of each
    feature defined in this module. </p>
  <p>A renderer is conformant to this specification
    if, in addition to interpreting the style sheet as defined by the
    appropriate specifications, it supports all the features defined
    by this specification by parsing them correctly
    and rendering the document accordingly. However, the inability of a
    UA to correctly render a document due to limitations of the device
    does not make the UA non-conformant. (For example, a UA is not
    required to render color on a monochrome monitor.) </p>
  <p>An authoring tool is conformant to this specification
    if it writes style sheets that are syntactically correct according to the
    generic CSS grammar and the individual grammars of each feature in
    this module, and meet all other conformance requirements of style sheets
    as described in this module. </p>
  <h3 class="no-ref heading settled" id="w3c-partial"><span class="content"> Partial implementations</span><a class="self-link" href="#w3c-partial"></a></h3>
  <p>So that authors can exploit the forward-compatible parsing rules to
    assign fallback values, CSS renderers <strong>must</strong> treat as invalid (and <a href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore
    as appropriate</a>) any at-rules, properties, property values, keywords,
    and other syntactic constructs for which they have no usable level of
    support. In particular, user agents <strong>must not</strong> selectively
    ignore unsupported component values and honor supported values in a single
    multi-value property declaration: if any value is considered invalid
    (as unsupported values must be), CSS requires that the entire declaration
    be ignored.</p>
  <h4 class="heading settled" id="w3c-conform-future-proofing"><span class="content"> Implementations of Unstable and Proprietary Features</span><a class="self-link" href="#w3c-conform-future-proofing"></a></h4>
  <p>To avoid clashes with future stable CSS features,
        the CSSWG recommends <a href="http://www.w3.org/TR/CSS/#future-proofing">following best practices</a> for the implementation of <a href="http://www.w3.org/TR/CSS/#unstable">unstable</a> features and <a href="http://www.w3.org/TR/CSS/#proprietary-extension">proprietary extensions</a> to CSS. </p>
  <h3 class="no-ref heading settled" id="w3c-testing"><span class="content"> Non-experimental implementations</span><a class="self-link" href="#w3c-testing"></a></h3>
  <p>Once a specification reaches the Candidate Recommendation stage,
    non-experimental implementations are possible, and implementors should
    release an unprefixed implementation of any CR-level feature they
    can demonstrate to be correctly implemented according to spec. </p>
  <p>To establish and maintain the interoperability of CSS across
    implementations, the CSS Working Group requests that non-experimental
    CSS renderers submit an implementation report (and, if necessary, the
    testcases used for that implementation report) to the W3C before
    releasing an unprefixed implementation of any CSS features. Testcases
    submitted to W3C are subject to review and correction by the CSS
    Working Group. </p>
  <p>Further information on submitting testcases and implementation reports
    can be found from on the CSS Working Group’s website at <a href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
    Questions should be directed to the <a href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a> mailing list.</p>
<script src="https://www.w3.org/scripts/TR/2021/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#css-canvas">canvas</a><span>, in § 2</span>
   <li><a href="#document-layer">document layer</a><span>, in § 2</span>
   <li><a href="#css-rendering-layer">layer</a><span>, in § 2</span>
   <li><a href="#paint-a-document">paint a document</a><span>, in § 2</span>
   <li><a href="#paint-a-layer">paint a layer</a><span>, in § 2</span>
   <li><a href="#paint-a-stacking-context">paint a stacking context</a><span>, in § 2</span>
   <li><a href="#paint-a-document">paint the document</a><span>, in § 2</span>
   <li><a href="#paint-a-layer">paint the layer</a><span>, in § 2</span>
   <li><a href="#paint-a-stacking-context">paint the stacking context</a><span>, in § 2</span>
   <li><a href="#propagate-its-background">propagate its background</a><span>, in § 2</span>
   <li><a href="#css-rendering-layer">rendering layer</a><span>, in § 2</span>
   <li><a href="#css-root-canvas">root canvas</a><span>, in § 2</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-propdef-background">
   <a href="https://drafts.csswg.org/css-backgrounds-3/#propdef-background">https://drafts.csswg.org/css-backgrounds-3/#propdef-background</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-background">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-background-painting-area">
   <a href="https://drafts.csswg.org/css-backgrounds-3/#background-painting-area">https://drafts.csswg.org/css-backgrounds-3/#background-painting-area</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-background-painting-area">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-background-positioning-area">
   <a href="https://drafts.csswg.org/css-backgrounds-3/#background-positioning-area">https://drafts.csswg.org/css-backgrounds-3/#background-positioning-area</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-background-positioning-area">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-transparent-black">
   <a href="https://drafts.csswg.org/css-color-4/#transparent-black">https://drafts.csswg.org/css-color-4/#transparent-black</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-transparent-black">2. Painting Order</a> <a href="#ref-for-transparent-black①">(2)</a> <a href="#ref-for-transparent-black②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-propdef-color-scheme">
   <a href="https://drafts.csswg.org/css-color-adjust-1/#propdef-color-scheme">https://drafts.csswg.org/css-color-adjust-1/#propdef-color-scheme</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propdef-color-scheme">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-block-level">
   <a href="https://drafts.csswg.org/css-display-3/#block-level">https://drafts.csswg.org/css-display-3/#block-level</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-block-level">2. Painting Order</a> <a href="#ref-for-block-level①">(2)</a> <a href="#ref-for-block-level②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-box">
   <a href="https://drafts.csswg.org/css-display-3/#box">https://drafts.csswg.org/css-display-3/#box</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-box">2. Painting Order</a> <a href="#ref-for-box①">(2)</a> <a href="#ref-for-box②">(3)</a> <a href="#ref-for-box③">(4)</a> <a href="#ref-for-box④">(5)</a> <a href="#ref-for-box⑤">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-elements">
   <a href="https://drafts.csswg.org/css-display-3/#elements">https://drafts.csswg.org/css-display-3/#elements</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-elements">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-positioned-box">
   <a href="https://drafts.csswg.org/css-position-3/#positioned-box">https://drafts.csswg.org/css-position-3/#positioned-box</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-positioned-box">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-table-wrapper-box">
   <a href="https://drafts.csswg.org/css-tables-3/#table-wrapper-box">https://drafts.csswg.org/css-tables-3/#table-wrapper-box</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-table-wrapper-box">2. Painting Order</a> <a href="#ref-for-table-wrapper-box①">(2)</a> <a href="#ref-for-table-wrapper-box②">(3)</a> <a href="#ref-for-table-wrapper-box③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-concept-tree">
   <a href="https://dom.spec.whatwg.org/#concept-tree">https://dom.spec.whatwg.org/#concept-tree</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-concept-tree">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-the-iframe-element">
   <a href="https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element">https://html.spec.whatwg.org/multipage/iframe-embed-object.html#the-iframe-element</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-the-iframe-element">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list">
   <a href="https://infra.spec.whatwg.org/#list">https://infra.spec.whatwg.org/#list</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list">2. Painting Order</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-TermStackingContext">
   <a href="https://svgwg.org/svg2-draft/render.html#TermStackingContext">https://svgwg.org/svg2-draft/render.html#TermStackingContext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-TermStackingContext">2. Painting Order</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[css-backgrounds-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-propdef-background">background</span>
     <li><span class="dfn-paneled" id="term-for-background-painting-area">background painting area</span>
     <li><span class="dfn-paneled" id="term-for-background-positioning-area">background positioning area</span>
    </ul>
   <li>
    <a data-link-type="biblio">[css-color-4]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-transparent-black">transparent black</span>
    </ul>
   <li>
    <a data-link-type="biblio">[css-color-adjust-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-propdef-color-scheme">color-scheme</span>
    </ul>
   <li>
    <a data-link-type="biblio">[css-display-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-block-level">block-level</span>
     <li><span class="dfn-paneled" id="term-for-box">box</span>
     <li><span class="dfn-paneled" id="term-for-elements">element</span>
    </ul>
   <li>
    <a data-link-type="biblio">[css-position-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-positioned-box">positioned</span>
    </ul>
   <li>
    <a data-link-type="biblio">[CSS-TABLES-3]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-table-wrapper-box">table wrapper box</span>
    </ul>
   <li>
    <a data-link-type="biblio">[DOM]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-concept-tree">tree</span>
    </ul>
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-the-iframe-element">iframe</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list">list</span>
    </ul>
   <li>
    <a data-link-type="biblio">[SVG2]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-TermStackingContext">stacking contexts</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-css-backgrounds-3">[CSS-BACKGROUNDS-3]
   <dd>Bert Bos; Elika Etemad; Brad Kemper. <a href="https://www.w3.org/TR/css-backgrounds-3/"><cite>CSS Backgrounds and Borders Module Level 3</cite></a>. 26 July 2021. CR. URL: <a href="https://www.w3.org/TR/css-backgrounds-3/">https://www.w3.org/TR/css-backgrounds-3/</a>
   <dt id="biblio-css-color-4">[CSS-COLOR-4]
   <dd>Tab Atkins Jr.; Chris Lilley; Lea Verou. <a href="https://www.w3.org/TR/css-color-4/"><cite>CSS Color Module Level 4</cite></a>. 15 December 2021. WD. URL: <a href="https://www.w3.org/TR/css-color-4/">https://www.w3.org/TR/css-color-4/</a>
   <dt id="biblio-css-color-adjust-1">[CSS-COLOR-ADJUST-1]
   <dd>Elika Etemad; et al. <a href="https://www.w3.org/TR/css-color-adjust-1/"><cite>CSS Color Adjustment Module Level 1</cite></a>. 10 February 2022. CR. URL: <a href="https://www.w3.org/TR/css-color-adjust-1/">https://www.w3.org/TR/css-color-adjust-1/</a>
   <dt id="biblio-css-display-3">[CSS-DISPLAY-3]
   <dd>Tab Atkins Jr.; Elika Etemad. <a href="https://www.w3.org/TR/css-display-3/"><cite>CSS Display Module Level 3</cite></a>. 3 September 2021. CR. URL: <a href="https://www.w3.org/TR/css-display-3/">https://www.w3.org/TR/css-display-3/</a>
   <dt id="biblio-css-position-3">[CSS-POSITION-3]
   <dd>Elika Etemad; Tab Atkins Jr.. <a href="https://www.w3.org/TR/css-position-3/"><cite>CSS Positioned Layout Module Level 3</cite></a>. 16 December 2021. WD. URL: <a href="https://www.w3.org/TR/css-position-3/">https://www.w3.org/TR/css-position-3/</a>
   <dt id="biblio-css-tables-3">[CSS-TABLES-3]
   <dd>François Remy; Greg Whitworth; David Baron. <a href="https://www.w3.org/TR/css-tables-3/"><cite>CSS Table Module Level 3</cite></a>. 27 July 2019. WD. URL: <a href="https://www.w3.org/TR/css-tables-3/">https://www.w3.org/TR/css-tables-3/</a>
   <dt id="biblio-dom">[DOM]
   <dd>Anne van Kesteren. <a href="https://dom.spec.whatwg.org/"><cite>DOM Standard</cite></a>. Living Standard. URL: <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org/</a>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/"><cite>HTML Standard</cite></a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd>Anne van Kesteren; Domenic Denicola. <a href="https://infra.spec.whatwg.org/"><cite>Infra Standard</cite></a>. Living Standard. URL: <a href="https://infra.spec.whatwg.org/">https://infra.spec.whatwg.org/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-svg2">[SVG2]
   <dd>Amelia Bellamy-Royds; et al. <a href="https://www.w3.org/TR/SVG2/"><cite>Scalable Vector Graphics (SVG) 2</cite></a>. 4 October 2018. CR. URL: <a href="https://www.w3.org/TR/SVG2/">https://www.w3.org/TR/SVG2/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-css-contain-3">[CSS-CONTAIN-3]
   <dd>Tab Atkins Jr.; Florian Rivoal; Miriam Suzanne. <a href="https://www.w3.org/TR/css-contain-3/"><cite>CSS Containment Module Level 3</cite></a>. 21 December 2021. WD. URL: <a href="https://www.w3.org/TR/css-contain-3/">https://www.w3.org/TR/css-contain-3/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> <a data-link-type="biblio" href="#biblio-css-contain-3">[CSS-CONTAIN-3]</a> should, apparently, block propagation,
but I can’t find that in the spec.
Figure out if I missed something,
and make it block propagation here. <a class="issue-return" href="#issue-6233971a" title="Jump to section">↵</a></div>
   <div class="issue"> Clipping/filtering/etc goes here. <a class="issue-return" href="#issue-2a74f3b1" title="Jump to section">↵</a></div>
   <div class="issue"> Does only the document layer have non-trivial whole-layer compositing? <a class="issue-return" href="#issue-8f014af0" title="Jump to section">↵</a></div>
   <div class="issue"> I think this needs more detail,
and I think <a data-link-type="biblio" href="#biblio-css-tables-3">[CSS-TABLES-3]</a> provides it. <a class="issue-return" href="#issue-09b8ddab" title="Jump to section">↵</a></div>
  </div>
  <aside class="dfn-panel" data-for="css-canvas">
   <b><a href="#css-canvas">#css-canvas</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-css-canvas">2. Painting Order</a> <a href="#ref-for-css-canvas①">(2)</a> <a href="#ref-for-css-canvas②">(3)</a> <a href="#ref-for-css-canvas③">(4)</a> <a href="#ref-for-css-canvas④">(5)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="css-root-canvas">
   <b><a href="#css-root-canvas">#css-root-canvas</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-css-root-canvas">2. Painting Order</a> <a href="#ref-for-css-root-canvas①">(2)</a> <a href="#ref-for-css-root-canvas②">(3)</a> <a href="#ref-for-css-root-canvas③">(4)</a> <a href="#ref-for-css-root-canvas④">(5)</a> <a href="#ref-for-css-root-canvas⑤">(6)</a> <a href="#ref-for-css-root-canvas⑥">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="css-rendering-layer">
   <b><a href="#css-rendering-layer">#css-rendering-layer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-css-rendering-layer">2. Painting Order</a> <a href="#ref-for-css-rendering-layer①">(2)</a> <a href="#ref-for-css-rendering-layer②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="document-layer">
   <b><a href="#document-layer">#document-layer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-document-layer">2. Painting Order</a> <a href="#ref-for-document-layer①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-a-layer">
   <b><a href="#paint-a-layer">#paint-a-layer</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-a-layer">2. Painting Order</a> <a href="#ref-for-paint-a-layer①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="propagate-its-background">
   <b><a href="#propagate-its-background">#propagate-its-background</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-propagate-its-background">2. Painting Order</a> <a href="#ref-for-propagate-its-background①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="paint-a-stacking-context">
   <b><a href="#paint-a-stacking-context">#paint-a-stacking-context</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-paint-a-stacking-context">2. Painting Order</a> <a href="#ref-for-paint-a-stacking-context①">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>
<script>/* script-var-click-highlighting */

    document.addEventListener("click", e=>{
        if(e.target.nodeName == "VAR") {
            highlightSameAlgoVars(e.target);
        }
    });
    {
        const indexCounts = new Map();
        const indexNames = new Map();
        function highlightSameAlgoVars(v) {
            // Find the algorithm container.
            let algoContainer = null;
            let searchEl = v;
            while(algoContainer == null && searchEl != document.body) {
                searchEl = searchEl.parentNode;
                if(searchEl.hasAttribute("data-algorithm")) {
                    algoContainer = searchEl;
                }
            }

            // Not highlighting document-global vars,
            // too likely to be unrelated.
            if(algoContainer == null) return;

            const algoName = algoContainer.getAttribute("data-algorithm");
            const varName = getVarName(v);
            const addClass = !v.classList.contains("selected");
            let highlightClass = null;
            if(addClass) {
                const index = chooseHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] += 1;
                indexNames.set(algoName+"///"+varName, index);
                highlightClass = nameFromIndex(index);
            } else {
                const index = previousHighlightIndex(algoName, varName);
                indexCounts.get(algoName)[index] -= 1;
                highlightClass = nameFromIndex(index);
            }

            // Find all same-name vars, and toggle their class appropriately.
            for(const el of algoContainer.querySelectorAll("var")) {
                if(getVarName(el) == varName) {
                    el.classList.toggle("selected", addClass);
                    el.classList.toggle(highlightClass, addClass);
                }
            }
        }
        function getVarName(el) {
            return el.textContent.replace(/(\s|\xa0)+/, " ").trim();
        }
        function chooseHighlightIndex(algoName, varName) {
            let indexes = null;
            if(indexCounts.has(algoName)) {
                indexes = indexCounts.get(algoName);
            } else {
                // 7 classes right now
                indexes = [0,0,0,0,0,0,0];
                indexCounts.set(algoName, indexes);
            }

            // If the element was recently unclicked,
            // *and* that color is still unclaimed,
            // give it back the same color.
            const lastIndex = previousHighlightIndex(algoName, varName);
            if(indexes[lastIndex] === 0) return lastIndex;

            // Find the earliest index with the lowest count.
            const minCount = Math.min.apply(null, indexes);
            let index = null;
            for(var i = 0; i < indexes.length; i++) {
                if(indexes[i] == minCount) {
                    return i;
                }
            }
        }
        function previousHighlightIndex(algoName, varName) {
            return indexNames.get(algoName+"///"+varName);
        }
        function nameFromIndex(index) {
            return "selected" + index;
        }
    }
    </script>